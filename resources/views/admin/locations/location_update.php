<?php require_once("../include/initialize.php"); ?><?php noLogin_verification(); ?><?php	if(isset($_POST["submit"])) {		echo"<pre>";		print_r($_FILES);		echo"</pre>";		$currentTripInfo = find_event_by_name($_POST["trip_name_users"]);		$duplicateNameCheck = find_all_events();		$location = cleanValues($_POST["trip_name"]);		$tripMonth = $_POST["trip_month"];		$tripYear = $_POST["trip_year"];		$tripComplete = $_POST["trip_completed"];		$showTrip = $_POST["show_trip"];		$tripID = $_POST["trip_id"];		$dueDate = $_POST["due_date"];		$depositDate = $_POST["deposit_date"];		$description = cleanValues($_POST["description"]);		$conditions = cleanValues($_POST["conditions"]);		$tripCost = cleanValues($_POST["cost"]);		$tripPayment = cleanValues($_POST["payments"]);		$tripIncludes = cleanValues($_POST["inclusions"]);		$tripPhoto = $_FILES["trip_photo"]["name"];		$photoSize = $_FILES["trip_photo"]["size"];		$flyerName = $_FILES["flyer_name"]["name"];		$flyerSize = $_FILES["flyer_name"]["size"];		$dupeCount = 0;				if($photoSize > 0) {			if($currentTripInfo["trip_photo"] == $tripPhoto) {				$tripPhoto = $currentTripInfo["trip_photo"];			} else {				$tripPhoto = checkNewPicture($_FILES["trip_photo"]);				if(isset($tripPhoto["name"])) {					$tripPhoto = $tripPhoto["name"];				} elseif($tripPhoto["errorName"]) {					$tripPhoto = $currentTripInfo["trip_photo"];				}			}			} else {			$tripPhoto = $currentTripInfo["trip_photo"];		}				if($flyerSize > 0) {			if($currentTripInfo["flyer_name"] == $flyerName) {				$flyerName = $currentTripInfo["flyer_name"];			} else {				$flyerName = checkNewDocument($_FILES["flyer_name"]);				if(isset($flyerName["name"])) {					$flyerName = $flyerName["name"];				} elseif(isset($flyerName["errorName"])) {					$flyerName = $currentTripInfo["flyer_name"];				}			}		} else {			$flyerName = $currentTripInfo["flyer_name"];		}				if($currentTripInfo["trip_location"] != $location) {			while($checkLocation = mysqli_fetch_assoc($duplicateNameCheck)) {				if($checkLocation["trip_location"] == $location) {					$dupeCount++;				}			}		}				if($dupeCount < 1) {			$query  = "UPDATE trip_location ";			$query .= "SET trip_location = '".$location."', ";			$query .= "trip_month = '".$tripMonth."', ";			$query .= "trip_year = '".$tripYear."', ";			$query .= "trip_photo = '".$tripPhoto."', ";			$query .= "flyer_name = '".$flyerName."', ";			$query .= "trip_complete = '".$tripComplete."', ";			$query .= "show_trip = '".$showTrip."', ";			$query .= "due_date = '".$dueDate."', ";			$query .= "deposit_date = '".$depositDate."', ";			$query .= "description = '".$description."', ";			$query .= "cost = '".$tripCost."', ";			$query .= "payments = '".$tripPayment."', ";			$query .= "inclusions = '".$tripIncludes."', ";			$query .= "conditions = '".$conditions."' ";			$query .= "WHERE trip_id = '".$tripID."';";			$data_set = mysqli_query($connect, $query);						if(!confirm_query($data_set)) {				if($oldName = file_exists("../public/" . str_ireplace(" ", "_", strtolower($currentTripInfo["trip_location"])) . $currentTripInfo["trip_year"] . ".php")) {					$oldName = "../public/" . str_ireplace(" ", "_", strtolower($currentTripInfo["trip_location"])) . $currentTripInfo["trip_year"] . ".php";					rename($oldName, "../public/" . str_ireplace(" ", "_", strtolower($location)) . $tripYear . ".php");				}				$_SESSION["message"] .= "<li class='okItem'>Location Updated Successfully</li>";				redirect_to("locations.php?edit_trip=" . htmlspecialchars($location));			}		} else {			$query  = "UPDATE trip_location ";			$query .= "SET trip_month = '".$tripMonth."', ";			$query .= "trip_year = '".$tripYear."', ";			$query .= "trip_photo = '".$tripPhoto."', ";			$query .= "flyer_name = '".$flyerName."', ";			$query .= "trip_complete = '".$tripComplete."', ";			$query .= "show_trip = '".$showTrip."', ";			$query .= "due_date = '".$dueDate."', ";			$query .= "deposit_date = '".$depositDate."', ";			$query .= "description = '".$description."', ";			$query .= "cost = '".$tripCost."', ";			$query .= "payments = '".$tripPayment."', ";			$query .= "inclusions = '".$tripIncludes."', ";			$query .= "conditions = '".$conditions."' ";			$query .= "WHERE trip_id = '".$tripID."';";			$data_set = mysqli_query($connect, $query);						$_SESSION["errors"] = "<li class='errorItem'>That trip name already exist. Please choose a different name.</li>";			redirect_to("locations.php?edit_trip=" . htmlspecialchars($currentTripInfo["trip_location"]));		}			} else {		$_SESSION["errors"] = "<li class='errorItem'>User not logged in or location has not been updated</li>";		redirect_to("locations.php?edit_trip=" . htmlspecialchars($location));	}	?>